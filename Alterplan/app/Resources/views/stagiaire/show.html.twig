{% extends 'consultationBase.html.twig' %}

{% block title %} Fiche du stagiaire {% endblock %}

{% block body %}
<div class="row">
    <div class="card">
        <div class="card-content">
            <h5 class="card-title">Informations</h5>
            <div class="col s4">
                <div class="col s12">
                    <h5>{{ stagiaireParEntreprise.stagiaire.nom }} {{ stagiaireParEntreprise.stagiaire.prenom }}</h5>
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.stagiaire.adresse1 }}
                </div>
                <div class="col s2">
                    {{ stagiaireParEntreprise.stagiaire.codePostal }}
                </div>
                <div class="col s10">
                    {{ stagiaireParEntreprise.stagiaire.ville }}
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.stagiaire.telephoneFixe }}
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.stagiaire.email }}
                </div>
            </div>
            <div class="col s4">
                <div class="col s12">
                    <h5>Formation</h5>
                </div>
                <div class="col s12">
                    Du (Date de début)
                </div>
                <div class="col s12">
                    Au (Date de fin)
                </div>

            </div>
            <div class="col s4">
                <div class="col s12">
                    <h5>{{ stagiaireParEntreprise.entreprise.raisonsociale }} </h5>
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.entreprise.adresse1 }}
                </div>
                <div class="col s2">
                    {{ stagiaireParEntreprise.entreprise.ville }}
                </div>
                <div class="col s10">
                    {{ stagiaireParEntreprise.entreprise.codePostal }}
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.entreprise.telephone }}
                </div>
                <div class="col s12">
                    {{ stagiaireParEntreprise.entreprise.email }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="calendar_table">
    <div class="card">
        <div class="row">
            <div class="col s6">
                <h5> Calendrier Inscrit </h5>
            </div>
            <div class="col s12">
                <table>
                    <thead>
                    <tr>
                        <th>{{ calendarRegistered.titre }}</th>
                        <th>{{ calendarRegistered.formation.codeFormation }}</th>
                        <th>{{ calendarRegistered.dateDebut.format('d/m/Y') }}</th>
                        <th>{{ calendarRegistered.dateFin.format('d/m/Y') }}</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col s6">
                <h5>Liste des calendriers </h5>
            </div>
        </div>

        <table>
            <thead>
            <tr>
                <th>Titre</th>
                <th>Formation</th>
                <th>Date de début</th>
                <th>Date de fin</th>
                <th>Suppression</th>
            </tr>
            </thead>
            <tbody>
                {% for calendar in calendars %}
                    <tr>
                        <td>
                            {{ calendar.titre }}
                        </td>

                        <td>
                            {{ calendar.formation.codeFormation }}
                        </td>

                        <td>
                            {{ calendar.dateDebut.format('d/m/Y') }}
                        </td>

                        <td>
                            {{ calendar.dateFin.format('d/m/Y') }}
                        </td>

                        <td>
                            <a href="#">
                                <i class="material-icons" data-href="{{ path('calendar_delete', {'codeCalendrier': calendar.codeCalendrier})}}">delete</i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">

    $(document).ready(function() {
        $('.material-icons').click(function () {
            var url = $(this).data("href");
            deleteCalendar(url);
        })
    });

    function refreshTable() {
        $.get('/stagiaires', function (data) {
            var calendarTableDiv = $('#calendar_table');
            calendarTableDiv.empty();
            calendarTableDiv.html(data);
        });
    }

    function deleteCalendar(urlAction) {
        showLoader();
        $.ajax({
            url: urlAction,
            type: 'DELETE',
            success: function (data) {
                dismissLoader();
                showToast(data);
                refreshTable();
            },
            error: function () {
                dismissLoader();
                showToast('Erreur de la suppression', 'error');
            }
        });
    }
</script>
{% endblock %}